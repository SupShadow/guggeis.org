---
// Newsletter-Anmeldung
// Nutzt Formspree für einfache Email-Sammlung
const formspreeId = "meoykgve"; // Gleiche ID wie Kontaktformular
---

<section id="newsletter" class="bg-primary py-12">
  <div class="max-w-4xl mx-auto px-6 lg:px-12 text-center">
    <h3 class="text-2xl font-headline text-white uppercase mb-3">
      Bleib auf dem Laufenden
    </h3>
    <p class="text-white mb-6 max-w-lg mx-auto">
      Erhalte Updates zu Veranstaltungen, neuen Ideen und dem Wahlkampf direkt in dein Postfach.
    </p>

    <form
      action={`https://formspree.io/f/${formspreeId}`}
      method="POST"
      class="flex flex-col sm:flex-row gap-3 justify-center max-w-md mx-auto"
      id="newsletter-form"
    >
      <!-- Hidden field to identify as newsletter signup -->
      <input type="hidden" name="_subject" value="Newsletter-Anmeldung" />
      <input type="hidden" name="type" value="newsletter" />

      <label for="newsletter-email" class="sr-only">E-Mail Adresse für Newsletter</label>
      <input
        id="newsletter-email"
        type="email"
        name="email"
        required
        aria-required="true"
        placeholder="Deine E-Mail-Adresse"
        class="flex-1 px-4 py-3 bg-white/20 text-white placeholder-white/90 border border-white/30 focus:outline-none focus:border-white focus:bg-white/30 transition-colors"
        autocomplete="email"
      />
      <button
        type="submit"
        class="px-6 py-3 bg-white text-primary font-headline uppercase text-sm tracking-wide hover:bg-white/90 transition-colors"
      >
        Anmelden
      </button>
    </form>

    <p id="newsletter-status" class="text-white/90 text-sm mt-4">
      Kein Spam. Abmeldung jederzeit möglich.
    </p>

    <!-- Success Message (hidden by default) -->
    <div id="newsletter-success" class="hidden mt-4 p-4 bg-white/20 text-white rounded" role="status" aria-live="polite">
      <p class="font-medium">Danke für deine Anmeldung!</p>
      <p class="text-sm text-white">Du erhältst bald Post von mir.</p>
    </div>

    <!-- Error Message (hidden by default) -->
    <div id="newsletter-error" class="hidden mt-4 p-4 bg-red-500/20 text-white rounded" role="alert" aria-live="assertive">
      <p class="font-medium">Anmeldung fehlgeschlagen</p>
      <p class="text-sm text-white/90">Bitte versuche es erneut oder schreib mir direkt.</p>
    </div>
  </div>
</section>

<script>
  const form = document.getElementById('newsletter-form') as HTMLFormElement;
  const success = document.getElementById('newsletter-success');
  const error = document.getElementById('newsletter-error');
  const status = document.getElementById('newsletter-status');

  form?.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Vorherige Fehlermeldungen ausblenden
    error?.classList.add('hidden');

    const formData = new FormData(form);

    try {
      const response = await fetch(form.action, {
        method: 'POST',
        body: formData,
        headers: { 'Accept': 'application/json' }
      });

      if (response.ok) {
        form.style.display = 'none';
        status?.classList.add('hidden');
        success?.classList.remove('hidden');
      } else {
        // API-Fehler anzeigen
        status?.classList.add('hidden');
        error?.classList.remove('hidden');
      }
    } catch (err) {
      // Netzwerk-Fehler anzeigen
      status?.classList.add('hidden');
      error?.classList.remove('hidden');
    }
  });
</script>
