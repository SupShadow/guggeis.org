---
// Unterstützer-Zähler mit animiertem Counter
interface Props {
  count?: number;
}

const { count } = Astro.props;
---

<div
  class="supporter-count flex items-center gap-3 text-dark/80"
  data-count={typeof count === 'number' ? count : undefined}
>
  <div class="flex -space-x-2">
    <!-- Stilisierte Avatar-Gruppe -->
    <div class="w-8 h-8 rounded-full bg-primary flex items-center justify-center text-white text-xs font-bold border-2 border-sand">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
      </svg>
    </div>
    <div class="w-8 h-8 rounded-full bg-secondary flex items-center justify-center text-white text-xs font-bold border-2 border-sand">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
      </svg>
    </div>
    <div class="w-8 h-8 rounded-full bg-accent-teal flex items-center justify-center text-white text-xs font-bold border-2 border-sand">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" />
      </svg>
    </div>
  </div>
  <p class="text-sm">
    {typeof count === 'number' ? (
      <>
        <span class="text-dark/70">Feedback von </span>
        <span class="font-headline text-primary text-lg counter-number">{count}</span>
        <span class="text-dark/70">+ Straubingern eingeflossen</span>
      </>
    ) : (
      <span class="text-dark/70">Feedback aus Straubing eingeflossen</span>
    )}
  </p>
</div>

<script>
  // Animierter Counter beim Scrollen
  const counters = document.querySelectorAll('.supporter-count');

  const animateCounter = (element: Element) => {
    const countAttr = element.getAttribute('data-count');
    if (!countAttr) return;
    const target = parseInt(countAttr, 10);
    if (Number.isNaN(target)) return;
    const numberEl = element.querySelector('.counter-number');
    if (!numberEl) return;

    let current = 0;
    const increment = target / 30; // 30 Schritte
    const duration = 1500; // 1.5 Sekunden
    const stepTime = duration / 30;

    const timer = setInterval(() => {
      current += increment;
      if (current >= target) {
        current = target;
        clearInterval(timer);
      }
      numberEl.textContent = Math.floor(current).toString();
    }, stepTime);
  };

  // Intersection Observer für Animation beim Sichtbarwerden
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        animateCounter(entry.target);
        observer.unobserve(entry.target);
      }
    });
  }, { threshold: 0.5 });

  counters.forEach(counter => observer.observe(counter));
</script>
